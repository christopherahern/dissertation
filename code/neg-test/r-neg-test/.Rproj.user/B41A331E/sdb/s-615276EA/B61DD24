{
    "contents" : "##########################################################################\n# Load libraries and scripts\nlibrary(ggplot2)\nlibrary(plyr)\nlibrary(dplyr)\nlibrary(reshape2)\nlibrary(xtable)\nsource(\"neg-data.R\")\nsource(\"binning.R\")\n##########################################################################\n# Read in data file and filter out texts and contexts\nneg.data.full = cleanNegData(\"coding.cod.ooo\")\nneg.data.full = tbl_df(neg.data.full)\n# Filter out tokens without do-support label, year, or type\nexcluded.texts = c(\"CMBOETH\", \"CMORM\", \"CMNTEST\",\"CMOTEST\")\n# CMBOETH : translation of Boethius' \"Consolation of Philosophy\", which is considered stilted\n# CMORM   : Ormulum is very specific poetic format\n# CMOTEST, CMNTEST : Old and new testaments\n# Lag the previous negative token\n# Exclude tokens where 'ne' is contracted, appears in negative concord, or looks like predicate negation\n# Group data into a number of fixed- and variable-width bins\nnumber = 5\nneg.data = neg.data.full %>% \n  mutate(prev.neg = lag(neg.type)) %>%\n  filter(! author %in% excluded.texts & exclude != \"X\") %>%\n  filter(!is.na(neg.type) & !is.na(prev.neg)) %>%\n  mutate(n.bin = cut(year, seq(min(.$year), max(year), (max(year)-min(year))/number), include.lowest=TRUE),\n         n.bin.label = cut(year, seq(min(.$year), max(year), (max(year)-min(year))/number), include.lowest=TRUE, label=FALSE),\n         q.bin = cut(year, as.vector(quantile(.$year, probs=seq(0,1,1/number))), include.lowest=TRUE))\n\nneg.test = neg.data %>% filter(n.bin.label == 1)\nneg.data %>% filter(n.bin.label == 1) %>% \n  group_by(neg.type) %>% summarize(count = n())\n\nneg.data %>% filter(n.bin.label == 1) %>% \n  group_by(prev.neg, neg.type) %>% \n  summarize(count=n())\n\nsummarize(total=n(), ne=sum(neg.type==\"ne\", na.rm=TRUE)/total,not=sum(neg.type==\"not\", na.rm=TRUE)/total,ne.not=sum(neg.type==\"both\", na.rm=TRUE)/total)\n\nfor (i in c(2:8)){\n  print(i)\n  print(seq(min(neg.data$year), max(neg.data$year), (max(neg.data$year)-min(neg.data$year))/i))\n  print(as.vector(quantile(neg.data$year, probs=seq(0,1,1/i))))\n}\n\nseq(min(neg.data$year), max(neg.data$year), (max(neg.data$year)-min(neg.data$year))/number)\nas.vector(quantile(neg.data$year, probs=seq(0,1,1/number)))\n\n##########################################################################\nneg.plot.auth = neg.data %>% \n  group_by(year, prev.neg) %>% \n  summarize(total=n(), ne=sum(neg.type==\"ne\", na.rm=TRUE)/total,not=sum(neg.type==\"not\", na.rm=TRUE)/total,ne.not=sum(neg.type==\"both\", na.rm=TRUE)/total)\nneg.plot.auth =  melt(neg.plot.auth, id=c(\"year\", \"prev.neg\", \"total\"))\n# Plot points and smooth fits\nggplot(aes(x = year, y = value, color = variable), data = neg.plot.auth) +\n  geom_point(aes(size = total), alpha = 0.5, position = position_jitter()) +\n  geom_smooth(aes(weight = total), method=\"loess\",se = FALSE) + # span=.5,\n  xlab(\"Year\") +   ylab(\"Proportion forms\") +   scale_size_area(\"N\", max_size = 20) +\n  theme(text = element_text(size=30)) +   theme(legend.position=\"none\") +\n  coord_cartesian(xlim = c(1090,1540)) +  coord_cartesian(ylim = c(-.1,1.1)) +\n  facet_wrap(~ prev.neg, nrow=1)\n##########################################################################\nneg.years =   neg.data %>% group_by(n.bin.label, prev.neg) %>%\n  summarize(total=n(),\n            ne.p=sum(neg.type==\"ne\")/total,\n            ne.se = sqrt(ne.p*(1-ne.p)/total),\n            ne.not.p=sum(neg.type==\"both\")/total,\n            ne.not.se = sqrt(ne.not.p*(1-ne.not.p)/total),\n            not.p=sum(neg.type==\"not\")/total,\n            not.se = sqrt(not.p*(1-not.p)/total))\n\nneg.years %>% filter(n.bin.label == 1)\n\nneg.data %>% group_by(n.bin.label) %>%\n  summarize(total=n(),\n            ne.p=sum(neg.type==\"ne\")/total,\n            ne.se = sqrt(ne.p*(1-ne.p)/total),\n            ne.not.p=sum(neg.type==\"both\")/total,\n            ne.not.se = sqrt(ne.not.p*(1-ne.not.p)/total),\n            not.p=sum(neg.type==\"not\")/total,\n            not.se = sqrt(not.p*(1-not.p)/total)) %>%\n  filter(n.bin.label == 1)\n\nneg.years.melt = melt(neg.years %>% select(n.bin, prev.neg, ne.p, not.p, ne.not.p), id=c('n.bin', 'prev.neg'))\n#test = melt(neg.years %>% select(n.bin, ne.p, not.p, ne.not.p), id=c('n.bin'))\n#ggplot(test, aes(x=n.bin, y=value, fill=variable)) + \n#  geom_bar(stat=\"identity\", position=\"dodge\")\nneg.years.melt$variable = factor(neg.years.melt$variable, levels = c(\"ne.p\", \"ne.not.p\", \"not.p\"))\nneg.years.melt$prev.neg = factor(neg.years.melt$prev.neg, levels = c(\"ne\", \"both\", \"not\"))\n#test = c('n.bin', 'prev.neg', 'total')\n#neg.years = melt(neg.years, id=test)\nneg.years.melt = melt(neg.years %>% select(n.bin, prev.neg, ne.p, not.p, ne.not.p), id=c('n.bin', 'prev.neg'))\n# Bar plots faceted  by previous form and time bin\nggplot(neg.years.melt, aes(x=n.bin, y=value, fill=variable)) + \n  geom_bar(stat=\"identity\", position=\"dodge\") + facet_wrap(~prev.neg)\nggplot(neg.years.melt, aes(x=prev.neg, y=value, fill=variable)) + \n  geom_bar(stat=\"identity\", position=\"dodge\") + facet_wrap(~ n.bin, nrow=1)\n# Lines faceted by previous form and time bin\nggplot(neg.years.melt, aes(x=n.bin, y=value, color=variable)) + \n  #geom_bar(stat=\"identity\", position=\"dodge\", aes(fill=variable,alpha=.1)) +\n  geom_line(position=\"identity\",aes(group=variable), size=3) + \n  facet_wrap(~prev.neg)\nggplot(neg.years.melt, aes(x=prev.neg, y=value, color=variable)) + \n  #geom_bar(stat=\"identity\", position=\"dodge\", aes(fill=variable,alpha=.2)) +\n  geom_line(position=\"identity\",aes(group=variable), size=4) + \n  facet_wrap(~ n.bin, nrow=1)\n\n# Let's do this for quantiles\nneg.quants = neg.data %>% group_by(q.bin, prev.neg) %>%\n  summarize(total=n(), \n            ne.p=sum(neg.type==\"ne\")/total,\n            ne.se = sqrt(ne.p*(1-ne.p)/total),\n            ne.not.p=sum(neg.type==\"both\")/total,\n            ne.not.se = sqrt(ne.not.p*(1-ne.not.p)/total),\n            not.p=sum(neg.type==\"not\")/total,\n            not.se = sqrt(not.p*(1-not.p)/total))\n#test = c('n.bin', 'prev.neg', 'total')\n#neg.quants = melt(neg.quants, id=test)\nneg.quants = melt(neg.quants %>% select(q.bin, prev.neg, ne.p, not.p, ne.not.p), id=c('q.bin', 'prev.neg'))\nneg.quants$variable = factor(neg.quants$variable, levels = c(\"ne.p\", \"ne.not.p\", \"not.p\"))\nneg.quants$prev.neg = factor(neg.quants$prev.neg, levels = c(\"ne\", \"both\", \"not\"))\n# Bar plots faceted  by previous form and time bin\nggplot(neg.quants, aes(x=q.bin, y=value, fill=variable)) + \n  geom_bar(stat=\"identity\", position=\"dodge\") + facet_wrap(~prev.neg)\nggplot(neg.quants, aes(x=prev.neg, y=value, fill=variable)) + \n  geom_bar(stat=\"identity\", position=\"dodge\") + facet_wrap(~ q.bin, nrow=1)\n# Lines faceted by previous form and time bin\nggplot(neg.quants, aes(x=q.bin, y=value, color=variable)) + \n  #geom_bar(stat=\"identity\", position=\"dodge\", aes(fill=variable,alpha=.1)) +\n  geom_line(position=\"identity\",aes(group=variable), size=3) + \n  facet_wrap(~prev.neg)\nggplot(neg.quants, aes(x=prev.neg, y=value, color=variable)) + \n  #geom_bar(stat=\"identity\", position=\"dodge\", aes(fill=variable,alpha=.2)) +\n  geom_line(position=\"identity\",aes(group=variable), size=4) + \n  facet_wrap(~ q.bin, nrow=1)\n\n#geom_errorbar(aes(ymin=perf-se, ymax=perf+se)\n",
    "created" : 1431965402461.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1651808444",
    "id" : "B61DD24",
    "lastKnownWriteTime" : 1431983001,
    "path" : "~/Dropbox/dissertation/code/neg-test/r-neg-test/permutation-notes.R",
    "project_path" : "permutation-notes.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "source_on_save" : false,
    "type" : "r_source"
}